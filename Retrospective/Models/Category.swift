//
//  Category.swift
//  Retrospective
//
//  Created by ê¹€ê±´ìš° on 5/12/25.
//

import SwiftUI
import SwiftData



/*
 * ğŸ“Œ ì—”í„°í‹° ê°„ ê´€ê³„ ë‹¤ì´ì–´ê·¸ë¨ (N:N)
 *
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚   Category    â”‚ *    * â”‚    Diary      â”‚
 * â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<------>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 * â”‚ - name        â”‚        â”‚ - title       â”‚
 * â”‚ - red         â”‚        â”‚ - content     â”‚
 * â”‚ - green       â”‚        â”‚ - createdDate â”‚
 * â”‚ - blue        â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 * â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚ + categories  â”‚
 * â”‚ + diaries     â”‚        â”‚               â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 *
 * - N:N (ë‹¤ëŒ€ë‹¤) ê´€ê³„:
 *   - ê° CategoryëŠ” ì—¬ëŸ¬ Diaryì— ì—°ê²°ë  ìˆ˜ ìˆìœ¼ë©°,
 *     ê° Diaryë„ ì—¬ëŸ¬ Categoryì— ì—°ê²°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
 * - Category â†’ Diary:
 *   - ì¹´í…Œê³ ë¦¬ëŠ” ì—¬ëŸ¬ ë‹¤ì´ì–´ë¦¬ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìœ¼ë©°,
 *     ë‹¤ì´ì–´ë¦¬ ì‚­ì œ ì‹œ í•´ë‹¹ ì°¸ì¡°ëŠ” ë¬´íš¨í™”(nullify)ë©ë‹ˆë‹¤.
 * - Diary â†’ Category:
 *   - ë‹¤ì´ì–´ë¦¬ëŠ” ì—¬ëŸ¬ ì¹´í…Œê³ ë¦¬ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìœ¼ë©°,
 *     ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹œ í•´ë‹¹ ì°¸ì¡°ëŠ” ë¬´íš¨í™”(nullify)ë©ë‹ˆë‹¤.
 */


// ìƒìœ„ ì—”í„°í‹°(Category)
@Model
final class Category {
    /// ì¹´í…Œê³ ë¦¬ì˜ ê³ ìœ  ì´ë¦„ì„ ë‚˜íƒ€ë‚´ëŠ” ì†ì„±ì…ë‹ˆë‹¤.
    /// - Note: ê° ì¹´í…Œê³ ë¦¬ì˜ ì´ë¦„ì€ ì¤‘ë³µë  ìˆ˜ ì—†ìœ¼ë©°, ê³ ìœ í•´ì•¼ í•©ë‹ˆë‹¤.
    @Attribute(.unique) var name: String
    /// ì¹´í…Œê³ ë¦¬ì˜ ìƒ‰ìƒì—ì„œ ë¹¨ê°„ìƒ‰(Red) êµ¬ì„± ìš”ì†Œ ê°’ (0 ~ 255)ì…ë‹ˆë‹¤.
    private var red: Double
    /// ì¹´í…Œê³ ë¦¬ì˜ ìƒ‰ìƒì—ì„œ ì´ˆë¡ìƒ‰(Green) êµ¬ì„± ìš”ì†Œ ê°’ (0 ~ 255)ì…ë‹ˆë‹¤.
    private var green: Double
    /// ì¹´í…Œê³ ë¦¬ì˜ ìƒ‰ìƒì—ì„œ íŒŒë€ìƒ‰(Blue) êµ¬ì„± ìš”ì†Œ ê°’ (0 ~ 255)ì…ë‹ˆë‹¤.
    private var blue: Double

    /// ì¹´í…Œê³ ë¦¬ë¥¼ ì ìš©í•œ ë‹¤ì´ì–´ë¦¬ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì†ì„±ì…ë‹ˆë‹¤.
    /// - Note: ë‹¤ì´ì–´ë¦¬ê°€ ì‚­ì œë  ê²½ìš°, ì¹´í…Œê³ ë¦¬ì—ì„œ í•´ë‹¹ ë‹¤ì´ì–´ë¦¬ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ë¬´íš¨í™”í•©ë‹ˆë‹¤. (nullify)
    @Relationship(deleteRule: .nullify) var diaries: [Diary] = []

    /// ì¹´í…Œê³ ë¦¬ì˜ ìƒ‰ìƒì„ ë°˜í™˜í•˜ëŠ” ê³„ì‚°ëœ ì†ì„±ì…ë‹ˆë‹¤.
    /// - Returns: RGB ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ëœ Color ê°ì²´
    var color: Color {
        .init(r: red, g: green, b: blue)
    }

    /// ì¹´í…Œê³ ë¦¬ ëª¨ë¸ì˜ ì´ˆê¸°í™” ë©”ì„œë“œì…ë‹ˆë‹¤.
    /// - Parameters:
    ///   - name: ì¹´í…Œê³ ë¦¬ì˜ ê³ ìœ  ì´ë¦„
    ///   - red: ìƒ‰ìƒì˜ ë¹¨ê°„ìƒ‰(Red) ê°’ (0 ~ 255)
    ///   - green: ìƒ‰ìƒì˜ ì´ˆë¡ìƒ‰(Green) ê°’ (0 ~ 255)
    ///   - blue: ìƒ‰ìƒì˜ íŒŒë€ìƒ‰(Blue) ê°’ (0 ~ 255)
    init(name: String, red: Double = 0.0, green: Double = 0.0, blue: Double = 0.0) {
        self.name = name
        self.red = red
        self.green = green
        self.blue = blue
    }
    
    /// ì¹´í…Œê³ ë¦¬ ëª¨ë¸ì˜ í¸ì˜ ì´ˆê¸°í™” ë©”ì„œë“œì…ë‹ˆë‹¤.
    /// - Parameters:
    ///   - name: ì¹´í…Œê³ ë¦¬ì˜ ê³ ìœ  ì´ë¦„
    ///   - color: ì¹´í…Œê³ ë¦¬ì˜ ìƒ‰ìƒ (Color ê°ì²´)
    /// - Note: Color ê°ì²´ì—ì„œ RGB ê°’ì„ ì¶”ì¶œí•˜ì—¬ ê° êµ¬ì„± ìš”ì†Œ(red, green, blue)ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
    convenience init(name: String, color: Color) {
        let rgb = color.rgbComponents()
        self.init(name: name, red: rgb.red, green: rgb.green, blue: rgb.blue)
    }
}

extension Category {
    
    /// RGB ê°’ìœ¼ë¡œ ìƒ‰ìƒì„ ì„¤ì •í•©ë‹ˆë‹¤.
    ///
    /// - Parameters:
    ///   - red: ë¹¨ê°„ìƒ‰(Red) êµ¬ì„± ìš”ì†Œ ê°’ (0.0 ~ 255.0)
    ///   - green: ì´ˆë¡ìƒ‰(Green) êµ¬ì„± ìš”ì†Œ ê°’ (0.0 ~ 255.0)
    ///   - blue: íŒŒë€ìƒ‰(Blue) êµ¬ì„± ìš”ì†Œ ê°’ (0.0 ~ 255.0)
    /// - Note: ê° êµ¬ì„± ìš”ì†Œ ê°’ì€ 0.0ì—ì„œ 255.0 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.
    func setColor(red: Double, green: Double, blue: Double) {
        guard (0...255) ~= red,
              (0...255) ~= green,
              (0...255) ~= blue else {
            fatalError("RGB ê°’ì€ 0.0ì—ì„œ 255.0 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.")
        }
        self.red = red
        self.green = green
        self.blue = blue
    }
}


extension Category {

    static let mock: [Category] = [
        .init(name: "ìŒì‹", color: .init(r: 255, g: 204, b: 102)),  // ë°ì€ ì˜¤ë Œì§€
        .init(name: "ìš´ë™", color: .init(r: 102, g: 204, b: 255)),  // ë°ì€ í•˜ëŠ˜ìƒ‰
        .init(name: "í•´ì™¸ ì—¬í–‰", color: .init(r: 153, g: 102, b: 255)),  // ì—°ë³´ë¼ìƒ‰
        .init(name: "êµ­ë‚´ ì—¬í–‰", color: .init(r: 255, g: 153, b: 204)),  // í•‘í¬
        .init(name: "ë…ì„œ", color: .init(r: 255, g: 102, b: 102)),  // ë°ì€ ë¹¨ê°„ìƒ‰
        .init(name: "ê³µë¶€", color: .init(r: 102, g: 255, b: 178)),  // ë°ì€ ì´ˆë¡ìƒ‰
        .init(name: "ìŒì•…", color: .init(r: 204, g: 102, b: 255)),  // ë³´ë¼ìƒ‰
        .init(name: "ê²Œì„", color: .init(r: 255, g: 178, b: 102)),  // ë°ì€ ì£¼í™©ìƒ‰
        .init(name: "ì·¨ë¯¸", color: .init(r: 102, g: 102, b: 255)),  // íŒŒë€ìƒ‰
        .init(name: "ì¼ê¸°", color: .init(r: 153, g: 255, b: 102))   // ë°ì€ ì—°ë‘ìƒ‰
    ]
}
